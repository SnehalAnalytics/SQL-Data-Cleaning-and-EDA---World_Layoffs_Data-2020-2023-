## Exploratory Data Analyis

-- with this info we are just going to look around and see what we find!
```
SELECT * FROM layoffs_staging2;
```
```
SELECT MAX(TOTAL_LAID_OFF), MAX(percentage_laid_off) 
FROM layoffs_staging2;
```

-- companies that laid off all employees
```
select * from layoffs_staging2 where percentage_laid_off = 1;
```

-- among these 100% laid off companies order it by total laid off to understand who had largest layoff and so on
```
select * from layoffs_staging2 where percentage_laid_off = 1 order by total_laid_off desc;
```
-- among these 100% laid off companies order it by largest funding 
```
select * from layoffs_staging2 where percentage_laid_off = 1 order by funds_raised_millions desc;
```
-- sum of total laid off in every company
```
select Company, sum(total_laid_off) as Tota from layoffs_staging2 group by company order by 2 desc;
```
-- whats the date range we are working with
```
select min(`date`), max(`date`) from layoffs_staging2;
```
-- sum of total laid off as per industry
```
select Industry, sum(total_laid_off) as Total from layoffs_staging2 group by industry order by 2 desc;
```
-- sum of total laid off as per country
```
select country, sum(total_laid_off) as Total from layoffs_staging2 group by country order by 2 desc;
```
-- sum of total laid off as per year
```
select year(`date`), sum(total_laid_off) as Total
from layoffs_staging2
group by year(`date`)
order by 1 desc;
```
-- sum of total laid off as per stage
```
select stage, sum(total_laid_off) as Total
from layoffs_staging2
group by stage
order by 2 desc;
```
```
select * from layoffs_staging2;
```

-- LAID OFFS PER MONTH
```
select month(`date`) from layoffs_staging2;
select substring(`date`,6,2) as `Month` from layoffs_staging2;
```
```
select substring(`date`,1,7) as `Month`, sum(total_laid_off) as Totals
from layoffs_staging2
where substring(`date`,1,7) IS NOT NULL
group by `month`
ORDER BY 1 ASC;
```
-- Rolling Total of Layoffs Per Month
```
WITH Rolling_total as 
(
select substring(`date`,1,7) as `Month`, sum(total_laid_off) as Totals
from layoffs_staging2
where substring(`date`,1,7) IS NOT NULL
group by `month`
ORDER BY 1 ASC
)
select `Month`, Totals, sum(Totals) over(order by `Month`) as Rolling_total from Rolling_total;
```
-- rolling sum of total laid off by every company in each year
```
With Rolling_Totals as 
(
select Company, substring(`date`,1,7) as `Month`, sum(total_laid_off) as Totals
from layoffs_staging2
where substring(`date`,1,7) IS NOT NULL
group by Company, `Month`
order by 1 asc
)
SELECT Company, `Month`, Totals, SUM(Totals) over(partition by company order by `month`) as Rolling_totals from Rolling_Totals;
```
-- which year which company laid off the most
```
select Company, Year(`date`), Sum(Total_laid_off)
from layoffs_staging2
group by Company, Year(`date`)
Order by 3 desc;
```
```
With Company_Year(Company, `Year`, Totals) as
(
select Company, Year(`date`) AS `YEAR`, Sum(Total_laid_off) as Totals
from layoffs_staging2
group by Company, Year(`date`)
Order by 3 desc
)
Select *, dense_rank() Over(partition by `YEAR` ORDER by Totals desc) as RNK 
from Company_Year
WHERE `YEAR` IS NOT NULL
ORDER BY RNK ASC;
```
-- filter the above code to top 5 companies per year
```
With Company_Year(Company, `Year`, Totals) as
(
select Company, Year(`date`) AS `YEAR`, Sum(Total_laid_off) as Totals
from layoffs_staging2
group by Company, Year(`date`)
Order by 3 desc
), Company_Year_Rank as (
Select *, dense_rank() Over(partition by `YEAR` ORDER by Totals desc) as RNK 
from Company_Year
WHERE `YEAR` IS NOT NULL)
select * from company_year_rank where RNK <=5;
```
